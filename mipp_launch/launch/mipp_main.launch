<?xml version="1.0"?>
<launch>
  <arg name="run_gazebo"  default="true"/>
  <arg name="world_file_name"   default="shapes_60x60" />
  <arg name="world_path"        default="$(find mipp_gazebo)/worlds/$(arg world_file_name).world" />
  <arg name="gui"         default="false"/>
  <arg name="run_rviz"    default="true"/>
  <arg name="run_husky"   default="true"/>
  <arg name="run_uavs"    default="true"/>
  <arg name="nr_of_uavs"  default="1"/>
  <arg name="octomap_cloud_topic"    default="/octomap/points"/>

  <node pkg="tf" type="static_transform_publisher" name="tf_map_odom_link" args="0 0 0 0 0 0  /map /odom  10"/>
  <node pkg="tf" type="static_transform_publisher" name="tf_world_map_link" args="0 0 0 0 0 0  /world /map  10"/>
  <node pkg="tf" type="static_transform_publisher" name="tf_base_frd_link" args="0 0 0 0 0 0  /world /base_link_frd  10"/>

  <!---
    Run OctoMap
  -->
  <include file="$(find mipp_launch)/launch/octomap_mapping.launch">
    <arg name="resolution"                      value="0.20"/>
    <arg name="frame_id"                        value="world"/>
		<arg name="base_frame_id"                   value="base_footprint"/>
		<arg name="sensor_model/max_range"          value="7.5"/>
  	<arg name="latch"                           value="false"/>
		<arg name="filter_ground"                   value="false"/>
		<arg name="pointcloud_min_z"                value="0.1"/>
		<arg name="pointcloud_max_z"                value="5.0"/>
		<arg name="occupancy_min_z"                value="0.2"/>
		<arg name="occupancy_max_z"                value="4.0"/>
	  <remap from="cloud_in"          to="$(arg octomap_cloud_topic)" />
  </include>

  <!--- 
    Spawn first uav
  -->
  <include file="$(find mipp_launch)/launch/uav.launch" if="$(eval arg('nr_of_uavs') >= 1)">
    <arg name="uav_id"        value="0"/>
    <arg name="initial_x"     value="-1"/>
    <arg name="initial_y"     value="-2"/>
    <arg name="octomap_cloud_topic"       value="$(arg octomap_cloud_topic)"/>
  </include>

  <!--- 
    Spawn second uav
  -->
  <include file="$(find mipp_launch)/launch/uav.launch" if="$(eval arg('nr_of_uavs') >= 2)">
    <arg name="uav_id"        value="1"/>
    <arg name="initial_x"     value="-1"/>
    <arg name="initial_y"     value="2"/>
    <arg name="octomap_cloud_topic"       value="$(arg octomap_cloud_topic)"/>
  </include>

  <!--- 
    Spawn third uav
  -->
  <include file="$(find mipp_launch)/launch/uav.launch" if="$(eval arg('nr_of_uavs') >= 3)">
    <arg name="uav_id"        value="2"/>
    <arg name="initial_x"     value="-3"/>
    <arg name="initial_y"     value="0"/>
    <arg name="octomap_cloud_topic"       value="$(arg octomap_cloud_topic)"/>
  </include>

  <!-- Load custom console configuration -->
  <env name="ROSCONSOLE_CONFIG_FILE" value="$(find mipp_launch)/resource/custom_rosconsole.conf"/>

  <!-- Launch rqt_reconfigure -->
  <node pkg="rqt_reconfigure" type="rqt_reconfigure" output="screen" name="rqt_reconfigure" />

  <!--- 
    Run Gazebo 
  -->
  <include file="$(find mipp_gazebo)/launch/mipp_gazebo.launch" if="$(arg run_gazebo)">
      <arg name="gui" value="$(arg gui)"/>
      <arg name="world_path" value="$(arg world_path)" />
  </include>

  <!--- 
    Run Rviz 
  -->
  <node name="rviz" pkg="rviz" type="rviz" output="log" args="-d $(find mipp_viz)/rviz/mipp_main.rviz"  if="$(arg run_rviz)"/>

  <!--- 
    Spawn single husky
  -->
  <arg name="ugv_ns"  default="/ugv"/>
  <group if="$(arg run_husky)">
    <include file="$(find mipp_launch)/launch/husky.launch">
      <arg name="robot_namespace"        value="$(arg ugv_ns)"/>
    </include>
  </group>

</launch>
